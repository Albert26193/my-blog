---
author: Albert
date: 2024-02-23
date created: 2024-02-22
description: 保证TCP协议稳定性的一种重要的机制，基于数据驱动的重传机制。
tags:
  - interview
  - network
title: 计算机网络-快速重传
---

# 计算机网络-快速重传

>[!info]
>cite: [4.2 TCP 重传、滑动窗口、流量控制、拥塞控制 | 小林coding](https://xiaolincoding.com/network/3_tcp/tcp_feature.html#%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0)

## 1. 数据驱动的重传

- 一般而言，基于 `RTO(Retransmission Timeout)` 可以实现重传，但是因为 `RTO` 的 *超时时间加倍* 特性，往往可能陷入过久的重传等待当中。
- 需要设计一种机制，**一旦确认数据丢失了，就应该立刻触发重传**。
- 快速重传机制就是为了解决 *重传时间等待过长* 的问题。
- 简单说，就是如果重复收到 `3` 次一样的 `ACK` 报文之后，就会触发快速重传，会立即发送报文。

## 2. 快速重传的缺点

![image.png|425](https://img-20221128.oss-cn-shanghai.aliyuncs.com/img-2023-05/20240222234243.png)

- 在接受方回复 `Ack6` 的报文之前，**发送方并不清楚自己到底丢了多少包**，`Seq2` 这个包肯定丢了，因为接受方反复要求确定 `Seq2`，但是 `Seq3/4` 不知道丢没丢。
- 如果仅仅发送一个 `Seq2`（就是假定其他包没丢），那么如果运气不好，其他包实际上丢了，那么对方又要发送 `Ack3` 来索要 `Seq3`，等等，一个一个重传效率不高。
- 如果将多个包，也就是 `Seq2/3/4` 全部发送过去（假定所有包全丢了），那么网络负载比较大，而且对方接收了之后，还是会把包丢弃掉，做了无用功。

## 3. `SACK`

- `SACK` 全称为 `Selective Acknowledgment`，选择性确认。
- 利用 `TCP` 头部的*选项*字段，接收者可以将已经接收到的信息传达给发送者，让它清楚收到了什么，没有收到什么。
- 在 `Linux 2.4` 以后，默认开启这个功能。

![image.png|500](https://img-20221128.oss-cn-shanghai.aliyuncs.com/img-2023-05/20240222235502.png)

- 上图可以清楚看到，每次发送 `ACK` 的时候，接受方会告之自己已经收到的信息，可以对消息进行选择性重传。

## 4. `D-SACK`

- `Duplicate SACK` 又称 `D-SACK`，其主要使用了 `SACK` 来告诉「发送方」有哪些数据被重复接收了。
- `Linux 2.4` 以后默认打开。
- `D-SACK` 有以下好处：
  - 可以让「发送方」知道，是发出去的包丢了，还是接收方回应的 `ACK` 包丢了;
  - 可以知道是不是「发送方」的数据包被网络延迟了;
  - 可以知道网络中是不是把「发送方」的数据包给复制了;