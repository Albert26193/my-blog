---
author: Albert
date: 2024-03-31
date created: 2024-01-11
tags:
  - Blog
  - Go
  - Interview
title: Go-进程、线程、协程的区别
---

# Go-进程、线程、协程的区别

## 1. 进程

- 进程是*操作系统资源调度和分配的最小单位*
- 是具备独立功能的程序在某个数据集合上进行的一次运行活动
- 每个进程都有自己独立的内存空间，需要通过进程间通信（管道、信号量、`socket` 等等）进行通信。
- 每个进程占据独立的内存，因此上下文切换的开销比较大。

## 2. 线程

- 线程是进程的一个实体，_是 `CPU` 资源调度和分派的基本单位。_
- 它是比进程更小的，能够独立运行的基本单位。
- _不独立占用完整的内存资源，只占据较小的、必不可少的资源_，比如程序计数器、一些必要寄存器和栈。
- **和从属于同一个进程的其他线程共享拥有的全部资源**，线程间通信的办法就比较简单了，通过共享内存，因此上下文切换的资源开销比较小。

## 3. 协程

- 协程和“进程、线程”不是一个纬度上的概念，协程的调度**完全通过用户控制**。
- _协程拥有自己的寄存器上下文和栈_，调度切换时，将寄存器的上下文和栈保存到其他地方， 在切回来的时候，恢复原本保存的寄存器上下文和栈。
- _可以不加锁访问全局变量，因此上下文切换非常快_。

> - 协程：**独立的栈空间，共享堆空间**，调度由用户自己控制，本质上有点类似于用户级线程，这些用户级线程的调度也是自己实现的。
> - 线程：一个线程上可以跑多个协程，协程是轻量级的线程。

- 协程到底有多轻量

|            | 协程                                                                                                            | 线程                                                                                            |
| ---------- | --------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| 内存占用   | 创建一个 `goroutine` 的栈内存消耗为 2 KB，<br>实际运行过程中，如果栈空间不够用，会自动进行扩容                  | 创建一个 线程 的栈内存消耗为 1 MB                                                               |
| 创建和销毀 | `goroutine` 因为是由 Go runtime 负责管理的，创建和销毁的消耗非常小，是用户级。                                  | 线程 _创建和销毀都会有巨大的消耗_，因为要和操作系统打交道，是内核级的，通常解决的办法就是线程池 |
| 切换       | `goroutines` 切换只需保存三个寄存器：PC、SP、BP<br>`goroutine` 的切换约为 `200 ns`，相当于 `2400-3600` 条指令。 | 线程切换会消耗 `1000-1500` ns，相当于 `12000-18000` 条指令。                                    |
