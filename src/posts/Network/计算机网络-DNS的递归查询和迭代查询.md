---
author: Albert
category: CS-基础
date: 2024-03-19
date created: 2023-05-09
date updated: 2022-12-07 23:10
tags:
  - Blog
  - Interview
  - Network
title: 计算机网络-DNS的递归查询和迭代查询
url: https://www.yuque.com/albert-tdjyy/bp5vz7/ngqbk6
---

# 计算机网络-DNS的递归查询和迭代查询

> [!note]
>
> - [【每日一题】- 2020-04-03 - DNS查询是递归查询还是迭代查询？ · Issue #108 · azl397985856/fe-interview · GitHub](https://github.com/azl397985856/fe-interview/issues/108)

- 整体流程如下所示：

![image.png|500](https://img-20221128.oss-cn-shanghai.aliyuncs.com/img-2023-05/20240319220215.png)

> 1. 用户在浏览器中输入 github.com；
> 2. github.com 请求被路由到 DNS 解析程序(一般由 ISP 进行管理)；
> 3. 如果 ISP 的 DNS 解析程序上有 github.com IP 地址的缓存，直接返回缓存，如果没有缓存或者缓存已过期，那就继续查询；
> 4. DNS 解析程序将请求转发到 DNS 根名称服务器(root nameserver)；
> 5. 根名称服务器根据请求的信息，决定把请求转发到 .com 域的一个 TLD(top-level domain)名称服务器；
> 6. 对于这个请求，.com 域的名称服务器响应了 8 个与 github.com 相关的名称服务器；
> 7. ISP 的 DNS 解析程序选择其中一个名称服务器 ns-421.awsdns-52.com. 并向它转发 github.com 请求；
> 8. 这个名称服务器在托管 github.com 的区域找到相应的 IP 地址 13.229.188.59 返回；
> 9. ISP 的 DNS 解析程序最终获取用户需要的 IP 地址，将它缓存起来，并把地址返回给浏览器；
> 10. 浏览器将请求发送到 13.229.188.59；
> 11. 13.229.188.59 上的 Web 服务器将页面返回显示在浏览器中。

## 1. 名词的解释

- _本地 DNS 服务器_：这里的本地不是严格意义上的本地，通常是 `ISP` 或者一些公共服务商，比如说 `cloudfare` 的 `1.1.1.1`，`Google` 的 `8.8.8.8`，一般可以在 `/etc/network/resolv.conf` 当中进行配置。
- _根 DNS 服务器_：最顶层的 `DNS` 服务器，负责管理 _顶级 DNS 服务器_，也就是**解析 `.com/.cn` 之类的顶级域名对应的地址**。
- _顶级 DNS 服务器_：次顶层的 `DNS` 服务，**负责解析其域名下所有的二级域名信息**。二级域名一般就是我们购买的域名，比如 `baidu/google` 之类的。
- _权限域名服务器_：第三层的域名服务器，负责解析具体的 `URL` 对应的所有的 `DNS` 信息。

## 2. 递归查询

- 主机向*本地域名服务器*的查询一般都是采用递归查询
- 如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向*其它根域名服务器*继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。
- 因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址。

## 3. 迭代查询

- **本地域名服务器向根域名服务器发起的查询一般是迭代查询**
- 当*根域名服务器*接收到*本地域名服务器*发起的查询请求的时候，要么给出所要查询的IP地址，要么告诉本地服务器；“你下一步应该去问谁”（就是给出顶级域对应的服务器的IP地址）
- 然后本地服务器依据*根服务器*给出的顶级域对应的服务器的IP地址，进行后续的查询。
- *顶级域服务器*接收到本地域名发起的查询请求的时候，要么给出所需的IP地址，要么告诉本地域名服务器下一步应该去问谁。
- 不断重复这个过程，直到报错或者拿到需要的IP地址
- 最后，*本地域名服务器*把结果反馈给主机（这一步属于是递归查询了）

![image.png|450](http://img-blog-01.oss-cn-shanghai.aliyuncs.com/img/2022-11-27-193708.png)

![image.png|325](http://img-blog-01.oss-cn-shanghai.aliyuncs.com/img/2022-11-27-193709.png)

> 递归：客户端只发一次请求，要求对方给出最终结果。
> 迭代：客户端发出一次请求，对方如果没有授权回答，它就会返回一个能解答这个查询的其它名称服务器列表，
> 客户端会再向返回的列表中发出请求，直到找到最终负责所查域名的名称服务器，从它得到最终结果。
> 授权回答：向dns服务器查询一个域名，刚好这个域名是本服务器负责，返回的结果就是授权回答。

![image.png|525](https://img-20221128.oss-cn-shanghai.aliyuncs.com/img-2023-05/20240319220456.png)

> 从递归和迭代查询可以看出：
> 客户端-本地dns服务端：这部分属于递归查询。
> 本地dns服务端---外网：这部分属于迭代查询。
> 递归查询时，返回的结果只有两种:查询成功或查询失败.
> 迭代查询，又称作重指引,返回的是最佳的查询点或者主机地址.
